# Chapter 2: ベクトルクラス (The Vec3 Class)

3次元グラフィックスにおいて、ほぼすべての要素は「ベクトル」で表現されます。
座標、色、方向、オフセット…これらはすべて `(x, y, z)` の3つの数字の組です。

この章では、このプロジェクトの心臓部となる `Vec3` 構造体を完成させます。

## 🎯 目標

*   ベクトル演算（加算、減算、乗算、除算）を演算子オーバーロード (`+`, `-`, `*`, `/`) で実装する。
*   ベクトル特有の操作（内積、外積、長さ、単位ベクトル化）を実装する。
*   `Copy` と `Clone` の挙動を理解する。

## 🧠 概念: あなたは今、何を作っているのか？

### 1. ベクトルの「長さ」と「長さの二乗」
ベクトル $\mathbf{v} = (x, y, z)$ の長さ $|\mathbf{v}|$ は $\sqrt{x^2 + y^2 + z^2}$ です。
しかし、コード内では頻繁に `length_squared()` ($x^2 + y^2 + z^2$) を使います。
**なぜでしょうか？**
(ヒント: 平方根 `sqrt` の計算コストについて考えてみてください)

### 2. 内積 (Dot Product) と 外積 (Cross Product)
これらは今後、嫌というほど出てきます。
*   **内積**: 照明計算（光がどれくらい当たっているか）に使います。
*   **外積**: カメラの向きを決める時など、「2つのベクトルに直交するベクトル」が欲しい時に使います。

## 🛠️ 実装ガイド (Step-by-Step)

`src/vec3.rs` を開き、以下の順序で実装を進めてください。

### Step 1: 基本的な演算 (Ops)
あなたは既に `Add` を実装しています。素晴らしい。
同様に `Sub` (減算)、`Mul` (乗算)、`Div` (除算) を実装してください。

**注意点**:
*   `Mul` と `Div` は少し特殊です。
    *   `Vec3 * f64` (ベクトルとスカラーの積)
    *   `Vec3 * Vec3` (要素ごとの積？ それとも内積？ 本家のC++コードでは「要素ごとの積」として定義されています)
    *   Genericsを使って `f64 * Vec3` もできるようにすると便利ですが、まずは `Vec3 * f64` だけで構いません。

```rust
// ヒント: std::ops::Mul を実装する
impl Mul<f64> for Vec3 {
    type Output = Vec3;
    fn mul(self, rhs: f64) -> Vec3 {
        // ...
    }
}
```

### Step 2: 幾何学的なメソッド
`impl Vec3` ブロックに以下のメソッドを追加してください。

*   `length(&self) -> f64`: ベクトルの長さ
*   `length_squared(&self) -> f64`: 長さの二乗
*   `dot(&self, other: &Vec3) -> f64`: 内積
*   `cross(&self, other: &Vec3) -> Vec3`: 外積
*   `unit_vector(&self) -> Vec3`: 単位ベクトル（長さが1のベクトル）を返す

**ソクラテス的質問**:
`unit_vector` は `self` を変更すべきでしょうか (`&mut self`)、それとも新しい `Vec3` を返すべきでしょうか (`-> Vec3`)？
(ヒント: Rustの所有権と不変性の原則、そして使いやすさを天秤にかけてください)

### Step 3: 色としてのエイリアス
本家では `using color = vec3;` のようにエイリアスを作っています。
Rustでも `pub type Color = Vec3;` や `pub type Point3 = Vec3;` を定義しておくと、引数の意図が明確になります。
`vec3.rs` の上部に追加しておきましょう。

## ✅ 完了チェックリスト

- [ ] `Vec3` - `Vec3` の加算・減算ができる
- [ ] `Vec3` * `f64` (スカラー倍) ができる
- [ ] `Vec3` / `f64` (スカラー除算) ができる
- [ ] `dot` (内積) が正しい値を返す
- [ ] `cross` (外積) が正しい値を返す
- [ ] `unit_vector` が長さ1のベクトルを返す

実装できたと思ったら、`main.rs` で少しテストコードを書いて動作確認してみましょう。
コンパイラが通るだけでなく、「値が正しいか」を確認するのがエンジニアの務めです。
